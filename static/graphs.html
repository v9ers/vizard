<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Vizard Graphs</title>
		<style>
			#countries, #users {
				width: 500px;
				height: 400px;
			}
			.left {
				float: left;
			}
		</style>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script> 
		<script type="text/javascript" src="js/highcharts.js"></script>
		<script type="text/javascript" src="js/vizard.js"></script>
		<script>
			var countries = vizard.create('countries', 'column');
			var users = vizard.create('users', 'line');

			function pollForMoreData() {
				$.getJSON('http://10.0.1.30:8008/v/freeall', function(data) {
					var countryData = [];
					var userData = [];
					
					for (var i in data.country.graph.bar.values) {
						countryData.push({x:i, y:data.country.graph.bar.values[i]});
					}
					for (var i=0; i<data.users.graph.line.x.length; i++) {
						userData.push({x:data.users.graph.line.x[i], y:data.users.graph.line.y[i]});
					}
					
					countryData.sort(function(a,b) {
						var sorting = {
							Others: 1
						};
						var cmp = (sorting[a.x] || 0) - (sorting[b.x] || 0);
						
						if (cmp !== 0) {
							return cmp;
						}

						return b.y - a.y;
					});
					userData.sort(function(a,b) {
						return a.x - b.x;
					});
				
					countries.set(countryData);
					users.set(userData);
				});
			}

			pollForMoreData();
			setInterval(pollForMoreData, 1000);
		</script>
	</head>
	<body>
		<h1>Vizard Graphs</h1>
		<div id="countries" class="left"></div>
		<div id="users" class="left"></div>
	</body>
</html>
